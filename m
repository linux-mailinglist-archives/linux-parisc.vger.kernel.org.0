Return-Path: <linux-parisc-owner@vger.kernel.org>
X-Original-To: lists+linux-parisc@lfdr.de
Delivered-To: lists+linux-parisc@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [23.128.96.18])
	by mail.lfdr.de (Postfix) with ESMTP id EE10E3FF4CC
	for <lists+linux-parisc@lfdr.de>; Thu,  2 Sep 2021 22:20:11 +0200 (CEST)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1345618AbhIBUVB (ORCPT <rfc822;lists+linux-parisc@lfdr.de>);
        Thu, 2 Sep 2021 16:21:01 -0400
Received: from mout.gmx.net ([212.227.15.19]:39417 "EHLO mout.gmx.net"
        rhost-flags-OK-OK-OK-OK) by vger.kernel.org with ESMTP
        id S231321AbhIBUVA (ORCPT <rfc822;linux-parisc@vger.kernel.org>);
        Thu, 2 Sep 2021 16:21:00 -0400
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=gmx.net;
        s=badeba3b8450; t=1630613993;
        bh=qRPsUq9hx09wEGufPwgQk/cwW0TimNF0thgYfsEZIVE=;
        h=X-UI-Sender-Class:Date:From:To:Cc:Subject:References:In-Reply-To;
        b=Q1L5cx1g0e8EmvQLOdiPPzH7mlqrAflgS5gARUBWOnQbXnDTZxf8FflEN0X5Hb+gE
         i8xuqbdPqowlZCEf7olNqbT802X13eC2pvuBBMAis62KmhQvMLGSKI9gRcLi+rufYl
         xNK8vcPtGh3Mibo0/Kbs2mvFmJ3bAZ7UIChTcuj8=
X-UI-Sender-Class: 01bb95c1-4bf8-414a-932a-4f6e2808ef9c
Received: from ls3530 ([92.116.158.38]) by mail.gmx.net (mrgmx004
 [212.227.17.190]) with ESMTPSA (Nemesis) id 1MeU0k-1mwKOz31RE-00aSUV; Thu, 02
 Sep 2021 22:19:53 +0200
Date:   Thu, 2 Sep 2021 22:19:49 +0200
From:   Helge Deller <deller@gmx.de>
To:     Helge Deller <deller@gmx.de>
Cc:     Arnd Bergmann <arnd@kernel.org>,
        Parisc List <linux-parisc@vger.kernel.org>,
        James Bottomley <James.Bottomley@hansenpartnership.com>,
        John David Anglin <dave.anglin@bell.net>
Subject: Re: [PATCH v2] parisc: Fix boot with kernel v5.14
Message-ID: <YTEx5e52HCTgXaJE@ls3530>
References: <YS6VGsZ7fZtZeu/i@ls3530>
 <YTDaZAMvAipdvkaB@ls3530>
 <CAK8P3a0zwnEUK_ztPRBx0H9VGBoPVY-+aASFV97zSKrL=diXUA@mail.gmail.com>
 <51d6b8cb-a64f-0cf7-1545-4c2fee89799e@gmx.de>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <51d6b8cb-a64f-0cf7-1545-4c2fee89799e@gmx.de>
X-Provags-ID: V03:K1:7K8k5hNjOCQfPfhAI27aqMAkiCKxOfd3Kq2Cu+KjjneQm54I0GK
 oa4ewkki+uTPVj+44Mj9VFla6290pPVS+s+z65T4TLAIbuiPHiXvNRQ9ghZhr/50/KS6ylT
 Oh41x+yhKFqtYsbu62sa9zPL62FY1iLcIyMPwbYBqF4iXt5Q7uVEHXFQykYj2qUV3OZhsoc
 52TgS8gY9NLy4HRqFMuJw==
X-Spam-Flag: NO
X-UI-Out-Filterresults: notjunk:1;V03:K0:rRhYehsrStA=:0RLG6kCMeQ2YlRxrgtbVjC
 uEOlB0LYv0O9TErqNMzuKAtkFfZSRn//Tp3/pR4f6bnzObhmeYxVImmofGDb4RYnGm5/aDFba
 PW9Vt9t7aED4cZfFuA4lgzGdWXvROPv25xgAlkU15mxtB5xkcxLEgQsh60833NM5w8CKXRONp
 igX5RbcmQo9fcgRKes7cvPLQFfc4Der3b6v3ps0RETyLYZHMIfMiOBMoO8guane92nNnFlDgM
 BUT/VgZ43pGOOpYgaA8rKfPrpP8YeOtlhQEVP/gadRJp8W032gY8Nqd8mOnh4HJDXON4y0lkx
 7D6yD+omh1r6ukxerwnQ4Cb9Q6YcJvvu5NU6hcYijHqcMLoW6KtfZUemEtgDqouhZ/VkqK9Qa
 z06xMXMiI2JUFjl5N2/CXGNExF/LCisbpQ9SrjD6Z6Ks70heEfOb74nBauwE/ld7tuBR6ItVM
 MeUaUdaRGtv+HM9SxcZquHYOdwlVmAXUnQMaG0BRf6uvTHlmEsaKuOnHMZ8ZzkrGEFPlJJDgH
 qjfvkFIa+5WVqRY8x0jkp2tcxYAL0hCm4dygA5KJcpT6PxwMbYQwZZACZFHvRuEOlnV6TalLz
 /z3kw1BgZO6Cg3mPem2Fmvtxdkjt1xR85/Z/wg6wyXcm9EV9AdydDSQMn7uPr/hnt3VB44uum
 vbt+xxnfpG8dLn/Rn5bCbGhOHOuq4o6R5FXb+qtOS9Uk97cA0UqhcmA8IxhsEiooX8JkgDxYs
 5ca1OgpJL79FFVTAGRN6vjM703fdFULlAVzN0GwkJmrw43jrZbX5kiQBiHmZMkXg5BXih2Bza
 GLmbdFxsRfms3tNExMUcwNfIaYM3VtG1QTvHJVl0NwohlrJc7rQWvtTS93DUVxMLU9zLdwniB
 2Mm2Ra8Zl+Xsos1IkHA7wLzXDdo4QkLoAOk1TuQMjAnGfOR9A1+H7GhpX72bE0wox3rAyyWYd
 /Bs1mpDyDLvZhgEYr+a6Wu4pZk4otzCVOetHbkYo+8aIc77xpYP/CtKS37H1HakoflGcWB6U5
 s71BoFu6c8XDd/JuN4ZwpokCou/CYxXV4+3dNsDejND/EqOZj2aB9puP3xUwlFWT9Rpa9XsDk
 vSYTpB/ZcZthkPknym/x9Wr8s9UC+VmRv+9
Content-Transfer-Encoding: quoted-printable
Precedence: bulk
List-ID: <linux-parisc.vger.kernel.org>
X-Mailing-List: linux-parisc@vger.kernel.org

> > The problem on parisc seems to be that at least
> > one variable is generated by the linker in a way that is incompatible
> > with the psABI but declared as a regular __u32.
>
> I'm happy to change it if it's just this one variable.

Currently only applying this patch seems to fix the boot issue.
Maybe it's just luck that compressed kernel files are correctly aligned.

Anyway, Arnd, please just wait and do not consider applying my previous pa=
tch.

Helge

diff --git a/arch/parisc/boot/compressed/misc.c b/arch/parisc/boot/compres=
sed/misc.c
index 2d395998f524..a9949ab9b283 100644
=2D-- a/arch/parisc/boot/compressed/misc.c
+++ b/arch/parisc/boot/compressed/misc.c
@@ -26,7 +26,7 @@
 extern char input_data[];
 extern int input_len;
 /* output_len is inserted by the linker possibly at an unaligned address =
*/
-extern __le32 output_len __aligned(1);
+extern char output_len;
 extern char _text, _end;
 extern char _bss, _ebss;
 extern char _startcode_end;
